---
name: test-tile
label: Generated Test Tile
description: A sample tile generated by tile-generator
icon_file: resources/icon.png

# Global defaults (all optional)
# org: test-org                       # Optional
# space: test-space                   # Optional
# docker_bosh_version: '28'           # Optional, default: latest release
# apply_open_security_group: true     # Apply open security group, default: false
allow_paid_service_plans: true        # Allow paid service plans, default: false
standalone: false                     # Suppress default CF properties in property_blueprints metadata, default: false

properties:
- name: author
  type: string
  label: Author
  value: Tile Ninja

#At least one form must be defined in tile.yml, otherwise there will be errors when staging the tile in Ops Manager
forms: 
- name: contact_form
  label: Contact Info
  description: Examples of basic property types
  properties:
  - name: customer_name
    type: string
    label: Full Name
    optional: true
  - name: street_address
    type: string
    label: Street Address
    description: Address to use for junk mail
    optional: false
  - name: city
    type: string
    label: City
  - name: zip_code
    type: string
    label: ZIP+4
    default: '90310'
  - name: country
    type: dropdown_select
    label: Country
    options:
    - name: country_us
      label: US
      default: true
    - name: country_elsewhere
      label: Elsewhere
- name: albums_form
  label: Albums
  description: Example of collection property type
  properties:
  - name: example_collection
    type: collection
    label: Albums
    configurable: true
    property_blueprints:
    # - name: id
    #   type: uuid
    - name: album
      type: string
      label: Album
    - name: artist
      type: string
      label: Artist
    - name: explicit
      type: boolean
      label: Explicit
    default:
    - album: Christmas Carols
      artist: Ops Manatee
      explicit: true
- name: food_form
  label: Food Order
  description: Example of selector property type
  properties:
  - name: example_selector
    type: selector
    label: Food Choices
    configurable: true
    default: Pizza
    option_templates:
    - name: pizza_option
      select_value: Pizza
      property_blueprints:
      - name: pepperoni
        type: boolean
        label: Pepperoni
        configurable: true
      - name: pineapple
        label: Pineapple
        type: boolean
        configurable: true
      - name: other_toppings
        label: Other Toppings
        type: string
        configurable: true
        optional: true
    - name: filet_mignon_option
      select_value: Filet Mignon
      property_blueprints:
      - name: steak_creds
        type: simple_credentials
        label: Complex type inside selector
        configurable: true
      - name: rarity_dropdown
        label: How rare?
        type: dropdown_select
        configurable: true
        default: rare
        options:
        - name: rare
          label: 'Rare'
        - name: medium
          label: 'Medium'
        - name: well-done
          label: 'Well done'
- name: credentials_form
  label: Credentials
  description: Examples of secret property types
  properties:
  - name: my_creds
    type: simple_credentials
    label: Simple Credentials
    description: Example of simple credentials type
  - name: username
    type: string
    label: Username
    constraints:
    - must_match_regex: '^[^!@#$%^&*()]*$'
      error_message: 'This name cannot contain capital digits.'
  - name: password
    type: secret
    label: Password
- name: update_form
  label: Update Settings
  description: Example of user-configured update Settings
  properties:
  - name: canary_watch_timeout
    type: integer
    label: Canary Watch Timeout
    description: Maximum amount of time to allow canaries to take before going healthy
  - name: update_watch_timeout
    type: integer
    label: Update Watch Timeout
    description: Maximum amount of time to allow non-canaries to take before going healthy
- name: selector_without_subproperties
  label: Selector without subproperties
  description: "Configure this feature."
  properties:
  - name: is_feature_enabled
    type: selector
    label: "Enable this feature?"
    description: "Choose whether or not to enable this feature."
    configurable: true
    default: feature_disabled
    optional: false
    option_templates:
    - name: feature_enabled
      select_value: feature_enabled
      label: Enable feature
      description: Enable this feature (requires more config).
      property_blueprints:
      - name: feature_config
        type: string
        label: Configure this feature
        configurable: true
    - name: feature_disabled
      select_value: feature_disabled
      label: Disable feature
      description: Disable this feature (no more config).

- name: planets_form
  label: Multi-Select Example
  properties:
  - name: planets
    label: Planets
    type: multi_select_options
    configurable: true
    optional: true
    options:
    - name: mercury
      label: mercury
    - name: Venus
      label: venus
    - name: Earth
      label: earth
    - name: Mars
      label: mars
    - name: Jupiter
      label: jupiter
    - name: Saturn
      label: saturn
    - name: Uranus
      label: uranus
    - name: Neptune
      label: neptune

- name: app_manifest_form
  label: App manifest config
  properties:
  - name: app_instances
    type: integer
    label: Dynamic app instance count
    default: 2

- name: auto_services_form
  label: Auto services config
  properties:
  - name: auto_service_name
    type: string
    label: Auto services service name
    default: tg-test-broker1-service

update:
  canary_watch_time: 10000-(( .properties.canary_watch_timeout ))
  update_watch_time: 10000-(( .properties.update_watch_timeout ))

service_plan_forms:
- name: custom_dynamic_service_plan_1
  label: Custom Dynamic Service Plan 1
  description: Custom Dynamic service plan 1 for Test Tile
  properties:
  - name: description1
    type: string
    configurable: true
    description: The description of this plan
  - name: license_key1
    type: string
    configurable: true
    description: The license key for this plan
  - name: num_seats1
    type: integer
    configurable: true
    description: The number of available seats for this license
    default: 1
    constraints:
      min: 1
      max: 500
- name: custom_dynamic_service_plan_2
  label: Custom Dynamic Service Plan 2
  description: Custom Dynamic service plan 2 for Test Tile
  properties:
  - name: description2
    type: string
    configurable: true
    description: The description of this plan
  - name: api_key2
    type: string
    configurable: true
    description: The api key for this plan
  - name: num_of_license2
    type: integer
    configurable: true
    description: The number of licenses
    default: 1

packages:

- name: tg-test-app1                  # App with minimal configuration, i.e. all default values
  type: app
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: python_buildpack       # Specify Buildpack for the app
    instances: (( .properties.app_instances.value ))

- name: tg-test-app1-auto-zip         # app1, specified by source directory to test auto-zipping
  type: app
  manifest:
    path: src/app
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: python_buildpack       # Specify Buildpack for the app

- name: tg-test-binary-app            # Self-contained app to test binary buildpack
  type: app
  manifest:
    path: src/binary-app/binary-app.py
    command: ./binary-app.py          # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: binary_buildpack

- name: tg-test-broker1               # Broker with minimal configuration, i.e. all default values
  type: app-broker
  enable_global_access_to_plans: true
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: python_buildpack

- name: tg-test-app2                  # App showing configurable values
  type: app
  consumes:
    redis:
      from: redis
    nats:
      from: nats
      deployment: (( ..cf.deployment_name ))
    docker-tcp:
      from: docker
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    host: tg-test-app2-hostname       # Override hostname, default: app name
    memory: 256M                      # Override memory, default: 1G
    buildpack: python_buildpack
  health_check: none                  # Turn off health monitoring, default: true
  auto_services:                      # Auto-provision and bind services
  - name: tg-test-broker1-service     # If using a broker in the same tile, the broker must preceed the app in this file
    plan: first-plan                  # Optionally specify a plan (default is the first plan offered by the service)
  - name: (( .properties.auto_service_name.value ))
  needs_cf_credentials: true          # Pass CF creds to the app, default: false

- name: tg-test-broker2               # Broker showing additional configurable values
  type: app-broker
  consumes:
    redis:
      from: redis
    nats:
      from: nats
      deployment: (( ..cf.deployment_name ))
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: python_buildpack
  internal_service_names:
  - service1
  - service2

- name: tg-test-buildpack             # A buildpack
  type: buildpack
  buildpack_order: 99                 # 99 (or higher) means go to the end of the list
  path: resources/buildpack.zip

- name: tg-test-app3
  type: docker-app
  image: guidowb/sample-cf-app        # Start command must be specified in the Dockerfile (CMD)
  manifest:
    memory: 256M                      # Override memory, default: 1G
  auto_services:                      # Auto-provision and bind services
  - name: tg-test-broker1-service     # If using a broker in the same tile, the broker must preceed the app in this file
    plan: second-plan                 # Optionally specify a plan (default is the first plan offered by the service)
    service_instance: tg-test-svc     # Optionally specify a name for the instance (default is <name>-<plan>)

- name: tg-test-app4
  type: docker-bosh
  docker_images:
  - guidowb/sample-cf-app
  cpu: 2
  memory: 512
  ephemeral_disk: 4096
  persistent_disk: 2048
  instances: 1
  routes:
    - prefix: my-route
      port: 8080
  manifest: |
    containers:
    - name: app
      image: "guidowb/sample-cf-app" # should match the docker image name
      bind_ports:
      - '80:80'
      - '443:443'
      - '8080:8080'
      - '8443:8443'

- name: tg-test-app5
  type: bosh-release
  path: resources/redis-13.1.2.tgz
  jobs:
  - name: redis
    templates:
    - name: redis
      release: redis
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 4096
    instances: 2
    cpu: 2
    static_ip: 0
    dynamic_ip: 1
    default_internet_connected: false
    max_in_flight: 1
    properties:
      password: red!s
  - name: sanity-tests
    templates:
    - name: sanity-tests
      release: redis
    lifecycle: errand
    post_deploy: true
    run_post_deploy_errand_default: when-changed
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 0
    cpu: 2
    dynamic_ip: 1
    properties:
      cf:
        some: property

- name: runtime-test-release
  type: bosh-release
  path: resources/runtime-test-release.tgz

- name: tg-test-app6
  type: bosh-release
  path: resources/no-op-release.tgz
  jobs:
  - name: node-yes
    instances: 1
    dynamic_ip: 1
    templates:
    - name: no-op
      release: no-op-release
      ##############################################################
      # These options turn this bosh job into a colocated errands: #
      ##############################################################
      colocated: true
      post_deploy: true # Must set post_deploy or pre_delete
      run_default: on # (Optional) You can set the run rules to on or off.
      instances: # (Optional) Array that tells BOSH where to run the errand.
      - node-yes/first
      # label: colocated errand X # Define the errand name to be shown.
      # description: This is an errand description.
      ###############################################################
    - name: route_registrar
      release: routing #relies on the fact that docker-bosh adds routing
      consumes:
        nats:
          from: nats
          deployment: (( ..cf.deployment_name ))
    properties:
      route_registrar:
        routes:
        - name: runtime_conf_yes
          port: 8119
          registration_interval: 20s
          uris:
          - runtime-conf-yes.(( ..cf.cloud_controller.system_domain.value ))
  - name: node-no
    instances: 1
    dynamic_ip: 1
    templates:
    - name: route_registrar
      release: routing
      consumes:
        nats:
          from: nats
          deployment: (( ..cf.deployment_name ))
    properties:
      route_registrar:
        routes:
        - name: runtime_conf_no
          port: 8119
          registration_interval: 20s
          uris:
          - runtime-conf-no.(( ..cf.cloud_controller.system_domain.value ))

- name: tg-test-app7
  type: bosh-release
  path: resources/standalone-release.tgz
  jobs:
  - name: no-op
    instances: 1
    dynamic_ip: 1
    type: standalone # Don't include default CF properties in generated job manifest
    templates:
    - name: no-op
      release: standalone-release

runtime_configs:
- name: example-runtime-config
  runtime_config:
    releases:
    - name: runtime-test-release
      version: 0.1.5
    addons:
    - name: runtime-test-release
      jobs:
      - name: hello
        release: runtime-test-release
      properties:
        hello:
         port:
           8119
      include:
        jobs:
        - name: no-op
          release: no-op-release
